services:
  orchestrator:
    build:
      context: .
      args:
        CODEX_DOCKER_REF: "${CODEX_DOCKER_REF:-main}"
        CODEX_DOCKER_CACHEBUST: "${CODEX_DOCKER_CACHEBUST:-1}"
    container_name: codex-orchestrator
    image: codex-orchestrator:latest
    ports:
      - "8080:8080"
    environment:
      HOME: "${HOST_HOME}"
      ORCH_HOME: "${HOST_HOME}/.codex-orchestrator"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ${HOST_HOME}:${HOST_HOME}
    user: "${UID}:${GID}"
    group_add:
      - "${DOCKER_GID}"
