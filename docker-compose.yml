services:
  orchestrator:
    image: "${ORCH_IMAGE:-ghcr.io/andreimarhatau/codex-docker-orchestrator:latest}"
    pull_policy: always
    container_name: codex-orchestrator
    ports:
      - "8080:8080"
    environment:
      HOME: "${HOST_HOME:-/root}"
      ORCH_HOME: "${HOST_HOME:-/root}/.codex-orchestrator"
      DOCKER_HOST: "unix:///var/run/docker.sock"
      TMPDIR: "${ORCH_TMPDIR:-/tmp}"
      GH_TOKEN: "${GH_TOKEN}"
      GIT_CONFIG_COUNT: "${GIT_CONFIG_COUNT:-2}"
      GIT_CONFIG_KEY_0: "${GIT_CONFIG_KEY_0:-credential.helper}"
      GIT_CONFIG_VALUE_0: "${GIT_CONFIG_VALUE_0:-}"
      GIT_CONFIG_KEY_1: "${GIT_CONFIG_KEY_1:-credential.helper}"
      GIT_CONFIG_VALUE_1: "${GIT_CONFIG_VALUE_1:-!/usr/bin/gh auth git-credential}"
    volumes:
      - ${DOCKER_SOCK:-/var/run/docker.sock}:/var/run/docker.sock
      - ${HOST_HOME:-/root}:${HOST_HOME:-/root}
    user: "${UID:-0}:${GID:-0}"
    group_add:
      - "${DOCKER_GID:-0}"
